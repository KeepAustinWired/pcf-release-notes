---
title: PCF Ops Manager v2.2 Release Notes
owner: Ops Manager
---

Pivotal Cloud Foundry is certified by the Cloud Foundry Foundation for <%= Date.today.year %>.

Read more about the [certified provider program](https://www.cloudfoundry.org/provider-faq/) and the [requirements of providers](https://www.cloudfoundry.org/provider-requirements/).

<p class="note"><strong>Note:</strong> Ops Manager API documentation is now public. For more information, see <a href="https://docs.pivotal.io/pivotalcf/2-2/installing/highlights.html#api-docs">PCF v2.2 Feature Highlights</a>.</p>

<hr>

## <a id='how-to-upgrade'></a> How to Upgrade

The [Upgrading Pivotal Cloud Foundry](http://docs.pivotal.io/pivoAztalcf/2-2/customizing/upgrading-pcf.html) topic contains instructions for upgrading to Pivotal Cloud Foundry (PCF) Ops Manager v2.2.

### 2.2.1

* **[Bug Fix]**: Fixes critical manifest generation grammar issue.
* **[Bug Fix]**: You can now delete an unused AZ in an installation after clicking **Apply Changes**.
* **[Bug Fix]**: Certain VM image components no longer write to the persistent disk after reboot.
* **[Bug Fix]**: Ops Manager now verfies certificates successfully when connecting to S3 blobstores with TLS. This resolves a <a href="#ki-opsmanager-tls-error">known issue</a> in Ops Manager v2.2.0. For more information, see [Operations Manager Validation returns TLS error when configuring Bosh Director S3 blobstore](https://pvtl.force.com/s/article/Operations-Manager-Validation-returns-TLS-error-when-configuring-Bosh-Director-S3-blobstore).
* **[Security Fix]**: Bumps Nokogiri to 1.8.4 to remediate [CVE-2017-15412](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-15412).
* **[Feature Improvement]**: Installation Dashboard and deployment status pages may load more quickly.

Ops Manager v2.2.1 uses the following component versions:

 <table border="1" class="nice">
  <thead>
  <tr>
    <th>Component</th>
    <th>Version</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>Stemcell</td><td>3586.25*</td>
  </tr><tr>
    <td>BBR SDK</td><td>1.6</td>
  </tr><tr>
    <td>BOSH Director</td><td>266.6*</td>
  </tr><tr>
    <td>BOSH DNS</td><td>1.6</td>
  </tr><tr>
    <td>CredHub</td><td>1.9.3</td>
  </tr><tr>
    <td>Syslog</td><td>11.3</td>
  </tr><tr>
    <td>UAA</td><td>57.4*</td>
  </tr><tr>
    <td>AWS CPI</td><td>70</td>
  </tr><tr>
    <td>Azure CPI</td><td>35.2</td>
  </tr><tr>
    <td>GCP CPI</td><td>27</td>
  </tr><tr>
    <td>OpenStack CPI</td><td>38</td>
  </tr>
  <tr>
    <td>vSphere CPI</td><td>50</td>
  </tr>
  <td colspan="2"><em>* Components marked with an asterisk have been patched to resolve security vulnerabilities or fix component behavior.</em></td>
  </tbody>
  </table>

### 2.2.0

Ops Manager v2.2.0 uses the following component versions:

 <table border="1" class="nice">
  <thead>
  <tr>
    <th>Component</th>
    <th>Version</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>Stemcell</td><td>3586.24</td>
  </tr><tr>
    <td>BBR SDK</td><td>1.6</td>
  </tr><tr>
    <td>BOSH Director</td><td>266.5</td>
  </tr><tr>
    <td>BOSH DNS</td><td>1.6</td>
  </tr><tr>
    <td>CredHub</td><td>1.9.3</td>
  </tr><tr>
    <td>Syslog</td><td>11.3</td>
  </tr><tr>
    <td>UAA</td><td>57.3</td>
  </tr><tr>
    <td>AWS CPI</td><td>70</td>
  </tr><tr>
    <td>Azure CPI</td><td>35.2</td>
  </tr><tr>
    <td>GCP CPI</td><td>27</td>
  </tr><tr>
    <td>OpenStack CPI</td><td>38</td>
  </tr><tr>
    <td>vSphere CPI</td><td>50</td>
  </tr><tr>
  </tbody>
  </table>


<hr>


## <a id='major-features'></a> New Features in Ops Manager v2.2

Ops Manager v2.2 includes the following major features:

### <a id='multi-dc'></a> Multiple Data Centers on vSphere

Ops Manager now allows you to configure multiple vSphere vCenters to a single BOSH Director.

You can add additional data centers in the **vSphere Config** pane of your vSphere BOSH Director tile. For more information about how to add, edit, and delete vCenters, see [Managing Multiple vSphere vCenters](http://docs.pivotal.io/pivotalcf/2-2/customizing/multiple-datacenters.html).

<p class="note"><strong>Note:</strong> If you use the Ops Manager API and multiple vSphere configs exist, the GET HTTP request for Director properties omits the <code>iaas_configuration</code> key.</p>

### <a id="selective-deploy"></a> Selectively Deploy Tiles in Ops Manager or via an API Endpoint

You can now choose to deploy a selection of tiles rather than all tiles in Ops Manager. If you choose to selectively deploy your environment, you can drastically reduce the time to **Apply Changes**. This feature is ideal to limit updates to one or more tiles, which reduces the amount of change in any given deployment.

To access this feature, click **Review Pending Changes** underneath the **Apply Changes** button in the Ops Manager Installation Dashboard. For more information, see [Reviewing Pending Changes with Ops Manager](https://docs.pivotal.io/pivotalcf/2-2/customizing/review-pending-changes.html).

In the Ops Manager UI, this feature is in beta. It is generally available as an API endpoint. To selectively deploy tiles via the API, send a POST to `/api/v0/installations`. For more information, see [Triggering an install process](http://docs.pivotal.io/pivotalcf/2-2/opsman-api/#triggering-an-install-process) in the Ops Manager API documentation.

<p class="note warning"><strong>WARNING:</strong> Do not selectively deploy tiles when upgrading to PCF v2.2. Instead, redeploy all product tiles using <strong>Apply Changes</strong> on the Ops Manager Installation Dashboard. For more information, see <a href="./breaking-changes.html#bosh-dns">Redeploy All Products After Upgrading to Ops Manager v2.2</a>.</p>

<p class="note"><strong>Note:</strong> Ops Manager is soliciting feedback for this feature. Submit feedback through your product architect or directly by emailing <a href="mailto:opsmanager-feedback+selective_deploys@pivotal.io">opsmanager-feedback+selective_deploys@pivotal.io</a>.</p>

### <a id="manifest-history"></a> Ops Manager Stores Past Manifests

Through the Ops Manager API, you can see Ops Manager's manifest history. Manifest history is helpful for running `diff` commands on manifests to see changes over time.

For this feature, use the following Ops Manager API endpoints:

- **/api/v0/installations/:installation\_id/products/:product\_guid/manifest**: For more information, see [Getting BOSH manifests from historical installations](http://docs.pivotal.io/pivotalcf/2-2/opsman-api/#getting-bosh-manifests-from-historical-installations) from the Ops Manager API documentation.

- **/api/v0/installations**: For more information, see [Getting a list of recent install events](http://docs.pivotal.io/pivotalcf/2-2/opsman-api/#getting-a-list-of-recent-install-events) from the Ops Manager API documentation.

### <a id="azure-stack"></a> Azure Stack is Generally Available

Pivotal officially supports Azure Stack.

Azure Stack is a hybrid cloud platform that lets you deliver Azure services from your own on-premise datacenter. For more information about Azure Stack, see [What is Azure Stack?](https://docs.microsoft.com/en-us/azure/azure-stack/azure-stack-poc) from the Microsoft Azure documentation.

You can configure Azure Stack through the **BOSH Director for Azure** tile. For more information about Azure Stack-specific configurations, see the steps in the [Azure Config Page](https://docs.pivotal.io/pivotalcf/2-2/customizing/azure-om-config.html#azure-config) section of the _Configuring BOSH Director on Azure_ topic.

### <a id="azure-china"></a> Ops Manager Supports Azure China

Ops Manager now supports a special region in Azure called Azure China. Azure China is a physically separated instance of cloud services that is located in China and independently operated. For more information about Azure China, see [What is Azure China 21Vianet?](https://docs.microsoft.com/en-us/azure/china/china-welcome) in the Azure China documentation.

To tell the BOSH Director that you are using an Azure China environment, go to the **BOSH Director for Azure** tile and select `Azure China Cloud` from the **Azure Environment** field. For more information, see [Azure Config Page](https://docs.pivotal.io/pivotalcf/2-2/customizing/azure-om-config.html#azure-config) in the _Configuring Ops Manager on Azure_ manual installation topic.

### <a id="om-credhub"></a> Ops Manager Credentials Stored in CredHub

On each **Apply Changes**, Ops Manager sends your user-specified credentials to BOSH CredHub. This feature offers greater security for your credentials. For more information about where Ops Manager stores your credentials, see [BOSH CredHub](https://docs.pivotal.io/pivotalcf/credhub/index.html#bosh).

For information about how this feature affects tile authors, see [PCF v2.2 Partners Release Notice](https://docs.pivotal.io/tiledev/2-2/release-notes-2-2.html#om-credhub) in the _PCF Tile Developer Guide_.

### <a id='secret-text-field'></a> Multi-Line Credentials

Ops Manager v2.2 now supports text areas for any type of multi-line credential. If you want a `secret` property to use a text area instead of the default single-line text field, you must set `display_type` to `text_area` in the `property_inputs` section of your property blueprint, as in the example below.

```
property_inputs:
  - reference: secret_meaning
    label: 'Secret Meaning'
    description: 'If you play it backwards...'
    display_type: 'text_area'
```

For more information, see the [Custom Forms and Properties](http://docs.pivotal.io/pivotalcf/2-2/tile-generator.html#custom-forms) section of the _Tile Generator_ topic.

### <a id="custom-ssl"></a> Specify a Custom Trusted SSL Certificate

Operators can specify a custom trusted SSL certificate and key for the Ops Manager server so that traffic isn't exposed to man-in-the-middle attacks when using Ops Manager.

By default, Ops Manager uses an auto-generated self-signed certificate. To change this configuration to your own SSL certificate, navigate to **Settings** from the Ops Manager Installation Dashboard and select the **SSL Certificate** pane to enter your **Certificate** and **Private Key**.

For more information about navigating the Ops Manager Settings page, see [Settings Page](http://docs.pivotal.io/pivotalcf/2-2/customizing/pcf-interface.html#settings) in the _Understanding the Ops Manager Interface_ topic.

<p class="note"><strong>Note:</strong> Custom SSL certificate and key is persisted between upgrades. Custom SSL only needs a one-time configuration.</p>

### <a id='delete-api-token'></a> Delete Your Pivotal Network API Token

You can now delete your Pivotal Network API token, along with the Pivotal Network release dashboard and all of the tile metadata from Pivotal Network products.

For more information, see [Settings Page](http://docs.pivotal.io/pivotalcf/2-2/customizing/pcf-interface.html#settings) in the _Understanding the Ops Manager Interface_ topic.

### <a id="om-syslog"></a> Configure an Ops Manager Syslog Server

You can configure a syslog server for Ops Manager logs. Logs include rails production logs, audit logs, UAA logs, nginx logs, and upstart logs for Ops Manager processes as well as additional log types. Previous to this change, Ops Manager logs were not centralized in one accessible location. You also have the option to TLS-encrypt your logs.

To configure syslog for Ops Manager, go to **Syslog** from Ops Manager **Settings**, select **Yes** to enable syslog and fill the required fields. Only administrators can view the Syslog pane.

For more information about configuring syslog for Ops Manager, see [Settings Page](http://docs.pivotal.io/pivotalcf/2-2/customizing/pcf-interface.html#settings) in the _Understanding the Ops Manager Interface_ topic.

<p class="note"><strong>Note:</strong> When you enter your syslog credentials, Ops Manager does not validate them. You should test your syslog server to ensure that the credentials were entered correctly and the server is receiving Ops Manager logs.</p>

<p class="note breaking"><strong>Breaking Change:</strong> If you were running scripts to get Ops Manager logs, those scripts break on upgrade to Ops Manager v2.2 and later.</p>

### <a id='trusty-to-xenial'></a> Xenial Stemcell Upgrade Support

As of April 2019, Trusty stemcells will no longer receive support, nor will Pivotal have CVE patches for them. Ops Manager v2.2 allows tile authors to upgrade from Trusty stemcells to Xenial stemcells.

### <a id="tls-blobstore"></a> TLS for Internal Blobstore Supported

Ops Manager now supports TLS communications if you choose to use an internal blobstore.

To enable internal blobstore TLS communication, all of your tiles must have stemcell v3586 or later. You can configure internal TLS by clicking **Enable TLS** in the **Director Config** pane of the BOSH Director tile.

### <a id='tls-external-db'></a> Custom TLS Certificate for External MySQL Database Supported

Ops Manager now allows you to configure a custom TLS certificate for an external MySQL database.

To configure a custom TLS certificate, navigate to **Director Config > Database Location** and select **External MySQL Database** to fill in the relevant fields.

<p class='note'><strong>Note:</strong> You must select <strong>Enable TLS for Director Database</strong> to configure the TLS-related fields.</p>

For more information, see the **Director Config Page** section of the [Ops Manager Director installation topic for your IaaS](https://docs.pivotal.io/pivotalcf/2-2/customizing/deploy-bosh-om.html).

### <a id="ui-changes"></a> UI Improvements to Installation Dashboard

The following lists UI changes to the Ops Manager Installation Dashboard:

- **Stemcell Library** is persistently in the page header. You can now access Stemcell Library from anywhere in Ops Manager.
- **Changelog** is persistently in the page header. You can now access the changelog from anywhere in Ops Manager.
- **Review Pending Changes BETA** button is below **Apply Changes**. For more information about this feature, see [Selectively Deploy Ops Manager Tiles](#selective-deploy).
- **Azure Logo** is updated.
- **BOSH Director tile name** is changed to "BOSH Director for YOUR_IAAS".
- **Changelog** page shows tiles which were not changed but were still deployed.

For more information about the Ops Manager UI, see [Installation Dashboard Page](https://docs.pivotal.io/pivotalcf/2-2/customizing/pcf-interface.html#installation-dashboard) in the _Understanding the Ops Manager Interface_ topic.

### <a id="changelog"></a> Change Log Includes Products Deployed but Unchanged

The [Change Log](https://docs.pivotal.io/pivotalcf/2-2/customizing/pcf-interface.html#changelog) pane lists products as **Unchanged** when they remain deployed, but their configuration has not changed from a prior deployment, so Ops Manager did not re-deploy them.

### <a id="staged-products-api"></a> More Detail Available Via Ops Manager API Endpoint

A new API endpoint is available for Ops Manager. Send a `GET` to `/v0/staged/pending_changes` to see details about your Ops Manager installation, including tile names, errand names, build version, and deployment status. The API response will show information on all tiles, whether they are deployed or have pending changes.

For more information about setting up the Ops Manager API, see [Using the Ops Manager API](https://docs.pivotal.io/pivotalcf/2-2/customizing/ops-man-api.html).

### <a id="identification-tags"></a> Custom Identification Tags Supported

You can specify a single set of tags that apply to all VMs and disks for your foundation. Identification tags allow you to easily identify which foundation your VMs belong to when viewing your IaaS. You are able to set custom **Identification Tags** in the **Director Config** pane of your BOSH Director tile.

For more information about configuring identification tags, see the **Director Config Page** section of the [Ops Manager Director installation topic for your IaaS](https://docs.pivotal.io/pivotalcf/2-2/customizing/deploy-bosh-om.html).

### <a id="bosh-dns-enabled"></a> BOSH DNS Enabled By Default

BOSH DNS is enabled by default for both app containers and PCF components in PCF v2.2. 

In previous versions, Consul managed service discovery between PCF components, but Consul is being replaced by BOSH DNS.

<p class="note"><strong>Note:</strong> In PCF v2.2, Consul and BOSH DNS are both available in PCF, but BOSH DNS is the only service used for DNS requests.</p> 

You can disable BOSH DNS if instructed to do so by Pivotal support. If you disabled BOSH DNS in PCF v2.1, reenable it before upgrading to PCF v2.2. For more information, see [BOSH DNS Enabled By Default](https://docs.pivotal.io/pivotalcf/2-2/installing/highlights.html#bosh-dns-enable).

<p class="note warning"><strong>WARNING:</strong> Do not disable BOSH DNS without instructions from Pivotal support. Disabling BOSH DNS will also disable PKS, NSX-T, and several PAS features.</p>

### <a id="when-changed"></a> "When Changed" Errand Setting Removed

Ops Manager no longer includes a **When Changed** option for tile errands. In the **Errands** pane for a given tile, you can set errands **On** to run them or **Off** to not run them. The default setting is **On**. 


## <a id="known-issues"></a> Known Issues

### <a id="ki-bosh-dns-hangs"></a>DNS Server Hangs or DNS Lookups Fail

With BOSH DNS, every BOSH-deployed VM has a DNS server. In large PCF installations, this DNS server may hang or DNS lookups may fail when the VM experiences too many DNS lookups in a short amount of time.

This error is caused by a race condition and deadlock in the VM's DNS server.

To fix this problem, run `monit` on the VM with failing DNS to restart its `bosh-dns` process.

### <a id="ki-opsmanager-tls-error"></a>Ops Manager Validation Returns TLS Error When Configuring BOSH Director S3 Blobstore

If a remote S3 blobstore uses a privately signed SSL certificate, operators see an error when configuring the BOSH Director to use an S3 blobstore. 

The error reads: `SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed (OpenSSL::SSL::SSLError) Unable to verify certificate. This may be an issue with the remote host or with Excon. Excon has certificates bundled, but these can be customized:`

This error appears because Ops Manager attempts to validate the S3 blobstore by testing the SSL certificate. Ops Manager does not use trusted certificates to make this connection, so the connection fails. 

A workaround is available for this issue. Operators can install the public CA certificate directly into the OS config of Ops Manager by following these steps:

1. SSH into the Ops Manager VM.
2. Copy the public CA certificate into `/etc/ssl/certs`.
3. Run `sudo update-ca-certificates -f -v`. This installs the new CA certificate.

Upon successful execution, "1 added" displays in the output. For example: `Updating certificates in /etc/ssl/certs... 1 added, 0 removed; done.`

This indicates the new certificate has been installed.

For more information, see the Knowledge Base article [Operations Manager Validation Returns TLS Error When Configuring BOSH Director S3 Blobstore](https://community.pivotal.io/s/article/Operations-Manager-Validation-returns-TLS-error-when-configuring-Bosh-Director-S3-blobstore).

### <a id="ki-deployment-fails-jobs-not-running"></a> Ops Manager Deployment Fails Because Monit Reports Job as Failed

This issue causes Ops Manager deployments to fail with an error indicating one or more jobs are not running after an update. 

The error reads:
`Error: 'cloud_controller/6632bf71-7493-4383-a3f9-9401bafb4710 (1)' is not running after update. Review logs for failed jobs: cloud_controller_ng`

Additionally, when you SSH into a VM and run `monit summary`, monit reports jobs as "Execution Failed".

To remediate this issue, use monit to restart the affected processes.

For more information, see the Knowledge Base article [Deployment Fails Because Monit Reports Job as Failed](https://community.pivotal.io/s/article/Deployment-fails-because-monit-reports-job-as-failed).
